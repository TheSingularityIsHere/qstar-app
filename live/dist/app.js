var a="https://wpswezsyahxwrwzulzwd.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indwc3dlenN5YWh4d3J3enVsendkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzYwOTAwOTQsImV4cCI6MjA1MTY2NjA5NH0.Z2wMXSG0SQa505TWJiheoJJbS4-k6yVJn_7eTS0CdQU";var p=window.supabase.createClient,i=p(a,l,{auth:{autoRefreshToken:!1,persistSession:!1},global:{headers:{"Content-Type":"application/json",Accept:"application/json"}}}),m=()=>{let s="survey_user_id",r=document.cookie.split("; ").find(e=>e.startsWith(s))?.split("=")[1];return r||(r=crypto.randomUUID(),document.cookie=`${s}=${r}; max-age=31536000; path=/`),r},c=m(),g=async()=>{try{let{data:s,error:r}=await i.from("survey_responses").select().eq("user_id",c);if(r){console.error("Error loading previous responses:",r),r.code==="406"?console.error("Content negotiation failed. Check headers and data format."):r.message?.includes("CORS")&&alert("CORS error detected. Please check Supabase configuration.");return}if(s.length){let e=s[0];console.log("got reponse",e),document.getElementById("profession").value=e.profession,document.getElementById("ageRange").value=e.age_range,document.getElementById("aiKnowledge").value=e.ai_knowledge.toString(),(e.previous_experiments||[]).forEach(t=>{document.getElementById(`exp${t}`).checked=!0})}}catch(s){console.error("Error:",s)}},h=async()=>{try{let s=[1,2,3,4].filter(o=>document.getElementById(`exp${o}`).checked),r={user_id:c,profession:document.getElementById("profession").value,age_range:document.getElementById("ageRange").value,ai_knowledge:parseInt(document.getElementById("aiKnowledge").value),previous_experiments:s,submitted_at:new Date().toISOString()},{error:e}=await i.from("survey_responses").upsert({...r});e?(console.error("Error submitting survey:",e),e.message?.includes("CORS")?alert("CORS error detected. Please check Supabase configuration."):alert("Error submitting survey. Please try again.")):alert("Survey submitted successfully!")}catch(s){console.error("Error:",s),alert("An unexpected error occurred.")}},y=()=>{let s=i.channel("survey_responses").on("postgres_changes",{event:"*",schema:"public",table:"survey_responses"},u).subscribe()},u=async()=>{let{data:s,error:r}=await i.from("survey_responses").select();if(r){console.error("Error fetching results:",r);return}let e={professions:{},ageRanges:{},aiKnowledge:{1:0,2:0,3:0,4:0,5:0},experiments:{1:0,2:0,3:0,4:0}};s.forEach(t=>{let n=t;e.professions[t.profession]=(e.professions[t.profession]||0)+1,e.ageRanges[t.age_range]=(e.ageRanges[t.age_range]||0)+1,e.aiKnowledge[t.ai_knowledge]++,t.previous_experiments.forEach(d=>{e.experiments[d]++})});let o=document.getElementById("results");o&&(o.innerHTML=`\n            <h3>Total Responses: ${s.length}</h3>\n\n            <h4>Professions:</h4>\n            <ul>${Object.entries(e.professions).map(([t,n])=>`<li>${t}: ${n} (${Math.round(n/s.length*100)}%)</li>`).join("")}</ul>\n\n            <h4>Age Ranges:</h4>\n            <ul>${Object.entries(e.ageRanges).map(([t,n])=>`<li>${t}: ${n} (${Math.round(n/s.length*100)}%)</li>`).join("")}</ul>\n\n            <h4>AI Knowledge Levels:</h4>\n            <ul>${Object.entries(e.aiKnowledge).map(([t,n])=>`<li>Level ${t}: ${n} (${Math.round(n/s.length*100)}%)</li>`).join("")}</ul>\n\n            <h4>Previous Experiments:</h4>\n            <ul>${Object.entries(e.experiments).map(([t,n])=>`<li>Experiment #${t}: ${n} (${Math.round(n/s.length*100)}%)</li>`).join("")}</ul>\n        `)},f=async()=>{new URLSearchParams(window.location.search).get("view")==="results"?(document.getElementById("surveyForm").style.display="none",document.getElementById("resultsView").style.display="block",await u(),y()):(await g(),document.getElementById("submitSurvey")?.addEventListener("click",h))};f();
//# sourceMappingURL=app.js.map
